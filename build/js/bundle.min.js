!function(){"use strict";function e(e,t="error",a=null){const n=document.createElement("div");n.classList.add("alerta"),"error"===t?n.classList.add("alerta__error"):"exito"===t&&n.classList.add("alerta__exito"),n.textContent=e;(a||document.querySelector("#miFormulario")||document.body).prepend(n),setTimeout((()=>n.remove()),5e3)}!function(){const e=document.querySelector("#caracteristicas_input");if(e){const t=document.querySelector("#caracteristicas"),a=document.querySelector('[name="caracteristicas"]');let n=[];function r(t){if(13===t.keyCode){if(""===t.target.value.trim()||t.target.value<1)return;t.preventDefault(),n=[...n,t.target.value.trim()],e.value="",i()}}function i(){t.textContent="",n.forEach((e=>{const a=document.createElement("LI");a.classList.add("formulario__caracteristica"),a.textContent=e,a.ondblclick=c,t.appendChild(a)})),o()}function c(e){e.target.remove(),n=n.filter((t=>t!==e.target.textContent)),o()}function o(){a.value=n.toString()}""!==a.value&&(n=a.value.split(","),i()),e.addEventListener("keypress",r)}}();const t=["jpg","jpeg","png","webp"];function a(e){return function(e){const a=e.split(".").pop().toLowerCase();return t.includes(a)}(e.name)?!!function(e){return e.size<=5242880}(e)||(mostrarAlerta(`El archivo ${e.name} excede los 5MB permitidos`,"error"),!1):(mostrarAlerta(`Archivo no permitido: ${e.name}. Solo se permiten ${t.join(", ")}`,"error"),!1)}document.addEventListener("DOMContentLoaded",(()=>{const t=document.querySelector("#imagenes"),n=document.querySelector("#preview-contenedor"),r=document.querySelector("#miFormulario");let i=[],c=[],o=[];const s=n.dataset.imagenesActuales;function d(){n.innerHTML="",c.forEach(((e,t)=>{const a=document.createElement("div");a.className="preview-imagen",a.dataset.actual="1",a.dataset.idImagen=e.id;const r=document.createElement("span");r.className="orden-visual",r.textContent=t+1,a.appendChild(r);const i=document.createElement("img");i.className="thumb",i.src=`/img/productos/thumbs/${e.url}.webp`,a.appendChild(i);const s=document.createElement("input");s.type="text",s.className="descripcion-imagen",s.value=e.descripcion||"",s.addEventListener("input",(()=>{c[t].descripcion=s.value})),a.appendChild(s);const l=document.createElement("button");l.className="btn-eliminar",l.textContent="X",l.addEventListener("click",(()=>{o.push(e.id),c.splice(t,1),d()})),a.appendChild(l),n.appendChild(a)})),i.forEach(((e,t)=>{const a=document.createElement("div");a.className="preview-imagen",a.dataset.actual="0";const r=document.createElement("span");r.className="orden-visual",r.textContent=c.length+t+1,a.appendChild(r);const o=document.createElement("img");o.className="thumb",o.src=e.base64,a.appendChild(o);const s=document.createElement("input");s.type="text",s.className="descripcion-imagen",s.value=e.descripcion||"",s.addEventListener("input",(()=>{i[t].descripcion=s.value})),a.appendChild(s);const l=document.createElement("button");l.className="btn-eliminar",l.textContent="X",l.addEventListener("click",(()=>{i.splice(t,1),d()})),a.appendChild(l),n.appendChild(a)}))}s&&(c=JSON.parse(s)),t&&t.addEventListener("change",(n=>{Array.from(n.target.files).forEach((t=>{if(!a(t))return;if(c.some((e=>e.url===t.name))||i.some((e=>e.archivo.name===t.name)))return void e("Imagen ya agregada","error");const n=new FileReader;n.onload=e=>{i.push({archivo:t,base64:e.target.result,descripcion:"",url:t.name}),d()},n.readAsDataURL(t)})),t.value=""})),n.addEventListener("dragstart",(e=>e.target.classList.add("dragging"))),n.addEventListener("dragend",(e=>{e.target.classList.remove("dragging");const t=n.querySelector(".dragging"),a=[...n.querySelectorAll(".preview-imagen:not(.dragging)")].find((e=>e.getBoundingClientRect().top>t.getBoundingClientRect().top));n.insertBefore(t,a||null);const r=[...c,...i],o=r.filter((e=>e.actual)),s=r.filter((e=>!e.actual));c=o,i=s,d()})),r&&r.addEventListener("submit",(t=>{if(t.preventDefault(),[...c,...i].some((e=>!e.descripcion||!e.descripcion.trim())))return void e("Rellena todas las descripciones","error");const a=new FormData(r);c.forEach(((e,t)=>{a.append(`actuales[${t}][id]`,e.id),a.append(`actuales[${t}][descripcion]`,e.descripcion),a.append(`actuales[${t}][orden]`,t),a.append(`actuales[${t}][eliminada]`,"0")})),o.forEach(((e,t)=>{a.append(`eliminadas[${t}]`,e)})),i.forEach(((e,t)=>{a.append(`imagenes[${t}]`,e.archivo),a.append(`descripciones[${t}]`,e.descripcion),a.append(`ordenes[${t}]`,c.length+t),a.append(`is_main[${t}]`,0===t?"1":"0")})),console.log("ðŸ“¨ formData:",Array.from(a.entries())),fetch(r.action,{method:"POST",body:a,headers:{"X-Requested-With":"XMLHttpRequest"}}).then((e=>e.text())).then((t=>{console.log("Respuesta del servidor:",t);try{const a=JSON.parse(t);"success"===a.status?(e("Producto actualizado correctamente","exito"),setTimeout((()=>{window.location.href=a.redirect||"/admin/productos"}),1500)):e(a.mensaje||"Error al actualizar producto.","error")}catch(t){console.error("âŒ JSON.parse fallÃ³:",err),e("Respuesta inesperada del servidor.","error")}}))})),d()})),function(){const e=document.querySelectorAll(".producto__boton"),t=document.createElement("DIV");t.classList.add("modal");let a=[];e.forEach((e=>{e.addEventListener("click",(async()=>{const n=e.dataset.id,r=await fetch(`/api/productos?id=${n}`);a=await r.json();const i=a.caracteristicas.split(",");console.log(i),t.classList.add("mostrar"),t.innerHTML=`\n                    <div class="modal__contenido animate-fade-in">\n                        <div>\n                            <a class="modal__cerrar">&times;</a>\n                        </div>\n                        <h2 class="modal__heading">${a.nombre}</h2>\n                        <div class="modal__grid">\n                            <div class="modal__imagen">\n                                <picture>\n                                    <source srcset="/img/productos/${a.imagen}.webp" type="image/webp">\n                                    <source srcset="/img/productos/${a.imagen}.png" type="image/png">\n                                    <img src="/img/productos/${a.imagen}.png" alt="${a.nombre}">\n                                </picture>\n                            </div>\n                            <div class="modal__descripcion">\n                                <p class="modal__descripcion">${a.descripcion}</p>                            \n                                <ul id="modalCaracteristicas"></ul>\n                            </div>                           \n                        </div>                        \n                        <div class="contenedor__boton">\n                            <a class="modal__boton" href="/contacto">Cotizar</a>\n                        </div> \n                    </div>\n                `,document.body.appendChild(t),i.forEach((e=>{const t=document.getElementById("modalCaracteristicas"),a=document.createElement("li");a.textContent=e.trim(),a.classList.add("modal__caracteristica"),t.appendChild(a)}))}))})),t.addEventListener("click",(e=>{if(e.target.classList.contains("modal__cerrar")||e.target===t){const e=t.querySelector(".modal__contenido");e?(e.classList.remove("animate-fade-in"),e.classList.add("animate-fade-out"),setTimeout((()=>{t.remove()}),380)):t.remove()}}))}(),function(){const e=document.querySelector("#whatsapp-float"),t=document.createElement("DIV");t.classList.add("modal-whatsapp"),e.addEventListener("click",(()=>{t.classList.add("mostrar-whatsapp"),t.classList.add("animate-fade-in"),t.innerHTML='\n                <div class="whatsapp__contenido ">\n                    <div class="whatsapp__header">\n                        <svg class="whatsapp__logo" width="150" height="35" viewBox="0 0 120 28" src="/img/whatsapp.svg" alt="Logo de WhatsApp"></svg>\n                        <a class="whatsapp__cerrar">&times;</a>\n                    </div>\n                    <div class="whatsapp__body">\n                        <div class="whatsapp__chat">\n                             <p class="whatsapp__texto">Hola,<br>Comunicate con nosotros por WhatsApp!</p>\n                        </div>\n                        <div class="whatsapp__abrirChat">\n                            <a href="https://wa.me/56920519944" class="whatsapp__boton" target="_blank" rel="noopener noreferrer" aria-label="WhatsApp">\n                                Abrir WhatsApp\n                            </a>\n                        </div>                           \n                    </div>\n                </div>\n            ',document.body.appendChild(t)})),t.addEventListener("click",(e=>{e.target.classList.contains("whatsapp__cerrar")&&t.remove()})),t.addEventListener("click",(e=>{e.target===t&&t.remove()}))}(),document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("galeria-producto-contenedor");if(!e)return;const t=e.dataset.imagenes;if(!t)return;const a=JSON.parse(t);if(!a||0===a.length)return;const n=document.getElementById("imagen-principal-producto"),r=document.getElementById("galeria-miniaturas"),i=document.getElementById("galeria-anterior"),c=document.getElementById("galeria-siguiente");if(!n||!r)return;let o=0;const s=e=>{if(e<0||e>=a.length)return;const t=a[e].url,i=n.parentElement;i.querySelector('source[type="image/webp"]').srcset=`/img/productos/${t}.webp`,i.querySelector('source[type="image/png"]').srcset=`/img/productos/${t}.png`,n.src=`/img/productos/${t}.png`,n.alt=`Imagen principal de producto - ${a[e].descripcion||""}`,r.querySelectorAll(".galeria-miniatura__contenedor").forEach((e=>e.classList.remove("activa")));const c=r.querySelector(`.galeria-miniatura__contenedor:has(img[data-indice="${e}"])`);c&&(c.classList.add("activa"),c.scrollIntoView({behavior:"smooth",block:"nearest",inline:"center"})),o=e};r.addEventListener("click",(e=>{if(e.target.classList.contains("galeria-miniatura__imagen")){const t=parseInt(e.target.dataset.indice);s(t)}})),i&&c&&(i.addEventListener("click",(()=>{let e=o-1;e<0&&(e=a.length-1),s(e)})),c.addEventListener("click",(()=>{let e=o+1;e>=a.length&&(e=0),s(e)})));const d=r.querySelector(".galeria-miniatura__contenedor.activa img");d&&(o=parseInt(d.dataset.indice))}))}();
//# sourceMappingURL=bundle.min.js.map
